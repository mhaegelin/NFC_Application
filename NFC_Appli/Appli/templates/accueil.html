<!DOCTYPE HTML>
<!--
	Hyperspace by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		{% load static %}
		<title>Application eLOG</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="{% static "assets/css/main.css" %}"/>
		<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
		<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
	</head>
	<body>
		<!-- Sidebar -->
			<section id="sidebar">
				<div class="inner">
					<nav>
						<ul>
							<li><a href="#intro">Bonjour</a></li>
							<li><a href="#one">Gestion Utilisateurs</a></li>
							<li><a href="#two">Gestion Etudiants</a></li>
							<li><a href="#three">Gestion Cours</a></li>
						</ul>
					</nav>
				</div>
			</section>

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Intro -->
					<section id="intro" class="wrapper style1 fullscreen fade-up">
						<div class="inner">
							<h1>eLOG</h1>
							<p>Bonjour {{ user.first_name }} {{ user.last_name }}!</p>
							<p>Vous êtes sur l'interface administrateur de eLOG.</p>
						</div>
					</section>

				<!-- One -->
					<section id="one" class="wrapper style3 fullscreen fade-up">
						<div class="inner">
							<h2>Sélectionner un utilisateur</h2>
							<p>Le formulaire mettra ses champs à jour automatiquement :</p>
							<div class="split style1">
								<section>
									<select id="listutil">
										<option value="default">#NoSelection#</option>
										{% for util in liste_util %}
										<option value="{{ util.idutil }}">{{util.idutil}} {{ util.first_name }} {{ util.last_name }}</option>
										{% endfor %}
									</select>
									<br>
									<ul class="actions" align="right">
											<li><a class="button" onClick="display_user_form();empty_data();action_ajouter();" name="add_user" id="add_user">Ajouter</a></li>
											<li><a class="button special disabled" onClick="display_user_form();load_data();action_modify();" name="change_user" id="change_user">Modifier</a></li>
											<li><a class="button special disabled" onClick="del_user();" name="drop_user" id="drop_user">Supprimer</a></li>
									</ul>
   	  								 <div id="user_form" hidden="true">
									 <form method="post" action="/Appli/accueil/">
										{% csrf_token %}
										<div class="split">
										<section>
										<div class="field">
											<label for="prenomutil">Prénom</label>
											<input type="text" name="prenomutil" id="prenomutil" />
										</div>
										</section>
										<section>
										<div class="field">
											<label for="nameutil">Nom de famille</label>
											<input type="text" name="nameutil" id="nameutil" />
										</div>
										</section>
										</div>
										<div class="split">
										<section>
										<div class="field">
											<label for="username">Nom d'utilisateur</label>
											<input type="text" name="username" id="username" />
										</div>
										</section>
										<section>
										<div class="field">
											<label for="mailutil">Email</label>
											<input type="text" name="mailutil" id="mailutil" />
										</div>
										</section>
										</div>
										<ul class="actions" align="right">
											<li><a onClick="" class="button" id="validation">Valider</a></li>
											<li><a class="button" onClick="hide_user_form();" id="annulation">Annuler</a></li>
										</ul>
									</form>
									</div>
									</section>
							</div>
						</div>
						<script>
						$("#listutil").change(function() {
						var utilname = $(this).val();
						var id = utilname.split(' ');
						
						if (id!="default") {
						$("#change_user").removeClass('button special disabled').addClass('button');
						$("#drop_user").removeClass('button special disabled').addClass('button');
						}
						else {
						$("#change_user").removeClass('button').addClass('button special disabled');
						$("#drop_user").removeClass('button').addClass('button special disabled');
						};
						});
						
						function display_user_form() {
						$("#user_form").show();
						$("#add_user").removeClass('button').addClass('button special disabled');
						$("#change_user").removeClass('button').addClass('button special disabled');
						$("#drop_user").removeClass('button').addClass('button special disabled');
						$("#listutil").prop('disabled', true);
						};
						
						function hide_user_form() {
						$("#user_form").hide();
						$("#add_user").removeClass('button special disabled').addClass('button');
						$("#listutil").prop('disabled', false);
						};
						
						
						function load_data() {
							var utilname = $("#listutil").val();
							var id = utilname.split(' ');
							
							$.ajax({
							url: '/Appli/accueil/ajaxutil',
							data: {
							'id': id[0]
							},
							dataType: 'json',
							success: function (data) {
							$("#username").val(data.user_name);
							$("#prenomutil").val(data.first_name);
							$("#nameutil").val(data.last_name);
							$("#mailutil").val(data.mail);
							}
							});
						}
						
						function empty_data() {
							$("#username").val('');
							$("#prenomutil").val('');
							$("#nameutil").val('');
							$("#mailutil").val('');
						}
						
						function action_ajouter() {
							//change l'action du bouton valider suite à clic sur ajout
							$("#validation").unbind('click');
							$("#annulation").unbind('click');
							$("#listutil").val('default').change();
							$("#validation").bind('click', function(){
								//set your method - validation
								//alert('Validation -- ajout');
								});
							$("#annulation").bind('click', function(){
								//set your method - validation
								//alert('Annulation -- ajout');
								//$("#listutil").val('default').change();
							});
						}
						
						function action_modify() {
							//change l'action du bouton valider suite à clic sur modifier
							$("#validation").unbind('click');
							$("#annulation").unbind('click');
							$("#validation").bind('click', function(){
								//set your method - validation
								//alert('Validation -- modifier');
								});
							$("#annulation").bind('click', function(){
								//set your method - validation
								//alert('Annulation -- modifier');
							});
						}
						
						function del_user() {
								var username = $("#listutil").val();
								var id = username.split(' ');
								alert(id[0]);
								$.ajax({
									url: '/Appli/accueil/deleteuser',
									data: {
									'id': id[0]
									},
									dataType: 'json',
									success: function (data) {
									//Supprimer la donnee de la liste select/option
									$("#listutil option[value='"+id[0]+"']").remove();
									}
								});
						}
					</script>
					</section>
				<!-- Two -->
					<section id="two" class="wrapper style1 fullscreen fade-up">
						<div class="inner">
							<h2>Selectionner un etudiant ou #NouvelEtudiant#</h2>
							<p>Le formulaire mettra ses champs à jour automatiquement : </p>
							<div class="split style1">
								<section>
									<select id="listpromo">
									<option>#Selectionner une promotion#</option>
									{% for promo in liste_promo %}
									<option> {{promo.idpromo}} {{promo.intitulepromo}}</option>
									{% endfor %}
									</select>
									<hr>
									<select id="listetud">
									<option>#NoSelection#</option>									
									</select>
									<hr>
		  							<script>
									        $("#listetud").change(function () {
									        var username = $("#listetud option:selected").text();
										var id = username.split(' ');
										$.ajax({
											url: '/Appli/accueil/ajaxetud',
											data: {
											  'id': id[0]
											},
											dataType: 'json',
											success: function (data) {
											    $("#name").val(data.name);
											    $("#surname").val(data.surname);
											    $("#mail").val(data.mail);
											}
										      });
									    });
									    
									    $("#listpromo").change(function() {
											load_listetud_accueil();
										});
						
										function load_listetud_accueil() {
										
											var promo = $("#listpromo").val();
											var id = promo.split(' ');
											
											$.ajax({
												url: '/Appli/accueil/ajaxlistetud',
												data: {
													'id': id[0]
												},
												dataType: 'json',
												success: function (data) {
													//Supprimer les elements préalablement dans le select option
													$('#listetud')
													.find('option')
													.remove()
													.end();
													$("#listetud").append('<option value=0>#NoSelection#</option>');
													listetud = eval(data.listetud);
													for (var key in listetud) {
														$("#listetud").append('<option value='+key+'>'+listetud[key].input_idetud + ' ' + listetud[key].input_prenometud
														+' ' + listetud[key].input_nometud+'</option>');
													}
												}
											});
										}
   	  								  </script>
									<form method="post" action="/Appli/accueil/">
										{% csrf_token %}
										<div class="field">
											<label for="name">Nom d'etudiant</label>
											<input type="text" name="name" id="name" />
										</div>
										<div class="field">
											<label for="prenom">Prenom etudiant</label>
											<input type="text" name="surname" id="surname" />
										</div>
										<div class="field">
											<label for="prenom">Mail etudiant</label>
											<input type="text" name="mail" id="mail" />
										</div>
										<ul class="actions" align="right">
											<li><a href="" class="button submit">Enregistrer</a></li>
											<li><a href="" class="button submit">Supprimer</a></li>
										</ul>
									</form>
								</section>
							</div>
						</div>
					</section>

				<!-- Three -->
					<section id="three" class="wrapper style3 fullscreen fade-up">
						<div class="inner">
							<h2>Ajouter Cours</h2>
							<p>Veuillez remplir le formulaire suivant pour ajouter un cours :</p>
							<div class="split style1">
								<section>
									<form method="post" action="#">
										<div class="field half first">
											<label for="name">Name</label>
											<input type="text" name="name" id="name" />
										</div>
										<div class="field half">
											<label for="email">Email</label>
											<input type="text" name="email" id="email" />
										</div>
										<div class="field">
											<label for="message">Message</label>
											<textarea name="message" id="message" rows="5"></textarea>
										</div>
										<ul class="actions" align="right">
											<li><a href="" class="button submit">Ajouter</a></li>
										</ul>
									</form>
								</section>
							</div>
						</div>
					</section>
			</div>
		<!-- Footer -->
			<footer id="footer" class="wrapper style1-alt">
				<div class="inner">
					<ul class="menu">
						<li>&copy; Untitled. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
					</ul>
				</div>
			</footer>

		<!-- Scripts -->
			<script src=" {% static "assets/js/jquery.min.js" %}"></script>
			<script src=" {% static "assets/js/jquery.scrollex.min.js" %}"></script>
			<script src=" {% static "assets/js/jquery.scrolly.min.js" %}"></script>
			<script src=" {% static "assets/js/skel.min.js" %}"></script>
			<script src=" {% static "assets/js/util.js" %}"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="{% static "assets/js/main.js" %}"></script>

	</body>
</html>
